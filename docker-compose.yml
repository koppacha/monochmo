services:
  dev:
    image: node:20-slim
    container_name: next-dev
    working_dir: /app
    command: sh -lc "corepack enable && yarn install && yarn dev -- -p 3010"
    environment:
      NODE_ENV: development
      PORT: 3010
    volumes:
      - ./:/app
      - node_modules:/app/node_modules
    ports:
      - "3010:3010"

  prod:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: next-prod
    environment:
      NODE_ENV: production
      PORT: 3010
    ports:
      - "3010:3010"
    restart: always

volumes:
  node_modules: